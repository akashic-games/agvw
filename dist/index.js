require=function o(a,s,l){function u(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[t]={exports:{}};a[t][0].call(n.exports,function(e){return u(a[t][1][e]||e)},n,n.exports,o,a,s,l)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AkashicGameView=void 0;var i=e("./SharedObject"),n=e("./DomElement"),o=e("./Error"),a=(s.prototype.addContent=function(e){if(null!=e.id)throw o.ErrorFactory.createInvalidOperationError("content already added: "+e.id);e.id=this._nextContentId++,e.start(this._gameViewShared,this._gameContentShared),this._contents[e.id+""]=e},s.prototype.removeContent=function(e){if(null==e.id)throw o.ErrorFactory.createInvalidOperationError("content already removed");e.destroy(),delete this._contents[e.id+""],e.id=null},s.prototype.removeAllContents=function(){var t=this;Object.keys(this._contents).forEach(function(e){t.removeContent(t._contents[e])})},s.prototype.setSocketOptions=function(e){this._gameViewShared.sessionManager.setSocketOptions(e)},s.prototype.registerExternalPlugin=function(e){this._gameViewShared.pluginManager.register(e)},s.prototype.setViewSize=function(e,t){this._gameContentShared.viewWidth=e,this._gameContentShared.viewHeight=t,this._gameContentShared.gameViewElement.setViewSize(e,t)},s.prototype.getViewSize=function(){return{width:this._gameContentShared.viewWidth,height:this._gameContentShared.viewHeight}},s.prototype.getContentById=function(e){return this._contents[e+""]},s.prototype.getGameViewSharedObject=function(){return this._gameViewShared},s.prototype.destroy=function(){this.destroyed()||(this.removeAllContents(),this._hasOwnGameViewShared&&(this._gameViewShared.destroyed()||this._gameViewShared.destroy(),this._hasOwnGameViewShared=!1),this._gameViewShared=null,this._gameContentShared=null)},s.prototype.destroyed=function(){return null==this._gameViewShared},s);function s(e){this._contents={},this._nextContentId=1,this._hasOwnGameViewShared=!1,this.vars={};var t=new n.GameViewElement(e.container);e.sharedObject?this._gameViewShared=e.sharedObject:(this._gameViewShared=new i.GameViewSharedObject({baseDownloader:e.baseDownloader,window:e.window,untrustedFrameUrl:e.untrustedFrameUrl,trustedChildOrigin:e.trustedChildOrigin}),this._hasOwnGameViewShared=!0),this._gameContentShared=new i.GameContentSharedObject({gameViewElement:t,gameViewWidth:e.width,gameViewHeight:e.height}),t.setViewSize(e.width,e.height)}r.AkashicGameView=a},{"./DomElement":4,"./Error":6,"./SharedObject":12}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.calcAspectFitLayout=r.calcFillLayout=r.calcNoneLayout=void 0;var i=e("@akashic/akashic-gameview");function a(e,t){switch(e.horizontalAlignment){case i.HorizontalAlignment.Left:return 0;case i.HorizontalAlignment.Center:return(e.outerWidth-t)/2;case i.HorizontalAlignment.Right:return e.outerWidth-t;default:return 0}}function s(e,t){switch(e.verticalAlignment){case i.VerticalAlignment.Top:return 0;case i.VerticalAlignment.Center:return(e.outerHeight-t)/2;case i.VerticalAlignment.Bottom:return e.outerHeight-t;default:return 0}}r.calcNoneLayout=function(e){var t=e.naturalWidth,r=e.naturalHeight;return{x:a(e,t),y:s(e,r),width:t,height:r}},r.calcFillLayout=function(e){return{x:0,y:0,width:e.outerWidth,height:e.outerHeight}},r.calcAspectFitLayout=function(e){var t=e.outerWidth/e.naturalWidth,r=e.outerHeight/e.naturalHeight,i=Math.min(t,r),n=e.naturalWidth*i,o=e.naturalHeight*i;return{x:a(e,n),y:s(e,o),width:n,height:o}}},{"@akashic/akashic-gameview":28}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Content=void 0;var i=e("@akashic/akashic-gameview"),n=e("./utils"),o=e("./Error"),a=(s.prototype.destroy=function(){this._contentDestroyListeners.forEach(function(e){return e.onDestroy()})},s.prototype.addContentLoadListener=function(e){this._contentLoadListeners.addItem(e)},s.prototype.removeContentLoadListener=function(e){this._contentLoadListeners.removeItem(e)},s.prototype.addErrorListener=function(e){this._errorListeners.addItem(e)},s.prototype.removeErrorListener=function(e){this._errorListeners.removeItem(e)},s.prototype.addContentDestroyListener=function(e){this._contentDestroyListeners.addItem(e)},s.prototype.removeContentDestroyListener=function(e){this._contentDestroyListeners.removeItem(e)},s.prototype.setContentArea=function(e){this._contentArea=n.assignObject(this._contentArea||{},e),this._contentAreaNeedsUpdate=!0,this._update()},s.prototype.getContentArea=function(){return n.assignObject({},this._contentArea)},s.prototype.setZIndex=function(e){this._zIndex=e,this._zIndexNeedsUpdate=!0,this._update()},s.prototype.getZIndex=function(){return this._zIndex},s.prototype.moveTopMost=function(){if(this._gameContentShared)this.setZIndex(this._gameContentShared.largestZIndex+1);else{var t=o.ErrorFactory.createInvalidOperationError("moveTopMost");this._errorListeners.forEach(function(e){return e.onError(t)})}},s.prototype.setContentLayout=function(e){this._contentLayout=n.assignObject(this._contentLayout||{},e),this._contentLayoutNeedsUpdate=!0,this._update()},s.prototype.getContentLayout=function(){return n.assignObject({},this._contentLayout)},s.prototype.hide=function(){!1!==this._visibility&&(this._visibility=!1,this._visibilityNeedsUpdate=!0,this._update())},s.prototype.show=function(){!0!==this._visibility&&(this._visibility=!0,this._visibilityNeedsUpdate=!0,this._update())},s.prototype.isVisible=function(){return this._visibility},s.prototype.getDataBus=function(){return this._dataBus},s);function s(e,t){this._gameContentShared=null,this._gameViewShared=null,this._contentLoadListeners=new n.ObjectList,this._errorListeners=new n.ObjectList,this._contentDestroyListeners=new n.ObjectList,this._contentArea=void 0,this._contentAreaNeedsUpdate=!1,this._zIndex=void 0,this._zIndexNeedsUpdate=!1,this._contentLayout={scaleMode:i.ScaleMode.AspectFit,verticalAlignment:i.VerticalAlignment.Center,horizontalAlignment:i.HorizontalAlignment.Center,passthroughEvent:!0,backgroundColor:"transparent"},this._contentLayoutNeedsUpdate=!1,this._visibility=!0,this._visibilityNeedsUpdate=!1,this._dataBus=null,this.id=null,this.vars={},this.type=t,this._contentUrl=e.contentUrl,null!=e.contentArea&&this.setContentArea(e.contentArea),null!=e.zIndex&&this.setZIndex(e.zIndex),null!=e.contentLayout&&this.setContentLayout(e.contentLayout)}r.Content=a},{"./Error":6,"./utils":27,"@akashic/akashic-gameview":28}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GameContentElement=r.WebContentElement=r.GameViewElement=void 0;var i=e("@akashic/akashic-gameview"),l=e("./utils"),n={mousedown:i.DroppedEventType.Down,mousemove:i.DroppedEventType.Move,mouseup:i.DroppedEventType.Up,touchstart:i.DroppedEventType.Down,touchmove:i.DroppedEventType.Move,touchend:i.DroppedEventType.Up,click:i.DroppedEventType.Click},o=(a.prototype.appendChild=function(e){this._htmlElement.appendChild(e)},a.prototype.removeChild=function(e){this._htmlElement.removeChild(e)},a.prototype.destroy=function(){this._parent.removeChild(this._htmlElement)},a.prototype.setViewSize=function(e,t){this._htmlElement.style.width=e+"px",this._htmlElement.style.height=t+"px"},a);function a(e){var t=document.createElement("div");t.style.position="relative",t.style.overflow="hidden",t.style.pointerEvents="none",e.appendChild(t),this._parent=e,this._htmlElement=t}r.GameViewElement=o;var s=(u.prototype.destroy=function(){this._parent.removeChild(this._htmlElement)},u.prototype.setContentArea=function(e){this._htmlElement.style.left=e.x+"px",this._htmlElement.style.top=e.y+"px",this._htmlElement.style.width=e.width+"px",this._htmlElement.style.height=e.height+"px"},u.prototype.setContentLayout=function(e){this._htmlElement.style.backgroundColor=e.backgroundColor},u.prototype.setZIndex=function(e){this._htmlElement.style.zIndex=e+""},u.prototype.setVisibility=function(e){this._htmlElement.style.display=e?"block":"none"},u.prototype.getContentWindow=function(){return this._htmlElement.contentWindow},u);function u(e,t,r){var i=this,n=document.createElement("iframe");n.style.position="absolute",n.style.borderStyle="none",n.style.pointerEvents="auto",n.addEventListener("load",function(){setTimeout(function(){r(i._htmlElement)},0)}),n.src=t,e.appendChild(n),this._parent=e,this._htmlElement=n}r.WebContentElement=s;var d=(h.prototype.destroy=function(){this._cleanupDropDomEventListeners(),this._parent.removeChild(this._outerHtmlElement)},h.prototype.setInnerSize=function(e){this._innerHtmlElement.style.left=e.x+"px",this._innerHtmlElement.style.top=e.y+"px",this._innerHtmlElement.style.width=e.width+"px",this._innerHtmlElement.style.height=e.height+"px"},h.prototype.setContentArea=function(e){this._outerHtmlElement.style.left=e.x+"px",this._outerHtmlElement.style.top=e.y+"px",this._outerHtmlElement.style.width=e.width+"px",this._outerHtmlElement.style.height=e.height+"px"},h.prototype.setContentLayout=function(e){this._outerHtmlElement.style.backgroundColor=e.backgroundColor,this._outerHtmlElement.style.pointerEvents=e.passthroughEvent?"none":"auto"},h.prototype.setZIndex=function(e){this._outerHtmlElement.style.zIndex=e+""},h.prototype.setVisibility=function(e){this._outerHtmlElement.style.display=e?"block":"none"},h.prototype.getContentWindow=function(){return this._gameContainerHtmlElement.contentWindow},h.prototype.addDroppedDomEventListener=function(e){this._droppedDomEventListeners.addItem(e)},h.prototype.removeDroppedDomEventListener=function(e){this._droppedDomEventListeners.removeItem(e)},h.prototype.setDropDomEvent=function(e){e?(this._gameContainerHtmlElement.style.pointerEvents="none",this._innerHtmlElement.style.pointerEvents="auto",this._innerHtmlElement.addEventListener("mousedown",this._handleMouseDown_bound),this._innerHtmlElement.addEventListener("touchstart",this._handleTouchStart_bound),this._innerHtmlElement.addEventListener("click",this._handleClick_bound)):(this._gameContainerHtmlElement.style.pointerEvents="auto",this._innerHtmlElement.style.pointerEvents="none",this._cleanupDropDomEventListeners()),this._isDropDomEvent=e},h.prototype._cleanupDropDomEventListeners=function(){this._innerHtmlElement.removeEventListener("mousedown",this._handleMouseDown_bound),this._innerHtmlElement.removeEventListener("touchstart",this._handleTouchStart_bound),this._innerHtmlElement.removeEventListener("click",this._handleClick_bound),this._innerHtmlElement.removeEventListener("touchmove",this._handleTouchMove_bound),this._innerHtmlElement.removeEventListener("touchend",this._handleTouchEnd_bound),window.removeEventListener("mousemove",this._handleMouseMove_bound),window.removeEventListener("mouseup",this._handleMouseUp_bound)},h.prototype._handleMouseDown=function(e){this._isTouched||(window.addEventListener("mousemove",this._handleMouseMove_bound),window.addEventListener("mouseup",this._handleMouseUp_bound),this._fireDroppedDomEvent(e))},h.prototype._handleMouseMove=function(e){this._isTouched||this._fireDroppedDomEvent(e)},h.prototype._handleMouseUp=function(e){window.removeEventListener("mousemove",this._handleMouseMove_bound),window.removeEventListener("mouseup",this._handleMouseUp_bound),this._fireDroppedDomEvent(e)},h.prototype._handleTouchStart=function(e){this._isTouched=!0,this._innerHtmlElement.addEventListener("touchmove",this._handleTouchMove_bound),this._innerHtmlElement.addEventListener("touchend",this._handleTouchEnd_bound),this._fireDroppedDomEvent(e)},h.prototype._handleTouchMove=function(e){this._fireDroppedDomEvent(e)},h.prototype._handleTouchEnd=function(e){this._innerHtmlElement.removeEventListener("touchmove",this._handleTouchMove_bound),this._innerHtmlElement.removeEventListener("touchend",this._handleTouchEnd_bound),this._fireDroppedDomEvent(e)},h.prototype._handleClick=function(e){this._isTouched=!1,this._isDropDomEvent&&this._fireDroppedDomEvent(e)},h.prototype._fireDroppedDomEvent=function(t){var r=n[t.type];null!=r&&this._droppedDomEventListeners.forEach(function(e){return e(r,t)})},h);function h(e,t,r){var i=this;this._isDropDomEvent=!1,this._isTouched=!1,this._droppedDomEventListeners=new l.ObjectList,this._handleMouseDown_bound=this._handleMouseDown.bind(this),this._handleMouseMove_bound=this._handleMouseMove.bind(this),this._handleMouseUp_bound=this._handleMouseUp.bind(this),this._handleTouchStart_bound=this._handleTouchStart.bind(this),this._handleTouchMove_bound=this._handleTouchMove.bind(this),this._handleTouchEnd_bound=this._handleTouchEnd.bind(this),this._handleClick_bound=this._handleClick.bind(this);var n=document.createElement("div");n.style.position="absolute",n.style.overflow="hidden",n.style.pointerEvents="auto";var o=null;if(t){var a=document.createElement("iframe");a.addEventListener("load",function(){setTimeout(function(){r(i._innerHtmlElement)},0)}),a.sandbox="allow-scripts allow-same-origin",a.src=t,a.scrolling="no",o=a}else o=document.createElement("div"),setTimeout(function(){return r(o)},0);o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.borderStyle="none",o.style.overflow="hidden",o.style.pointerEvents="auto";var s=document.createElement("div");s.style.position="absolute",s.style.pointerEvents="none",s.appendChild(o),n.appendChild(s),e.appendChild(n),this._parent=e,this._outerHtmlElement=n,this._innerHtmlElement=s,this._gameContainerHtmlElement=o}r.GameContentElement=d},{"./utils":27,"@akashic/akashic-gameview":28}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RetryDownloader=r.XhrDownloader=void 0;var i=(n.prototype.start=function(t,r){var i=this._createXmlHttpRequest();return i.open("GET",t),i.responseType="text",i.timeout=this.defaultTimeOut,i.addEventListener("load",function(e){200<=i.status&&i.status<300?r(null,i.responseText):r(new Error("request failed: "+t),null)}),i.addEventListener("error",function(e){return r(new Error("request error: "+t),null)}),i.addEventListener("timeout",function(e){return r(new Error("request timed out: "+t),null)}),i.send(),{cancel:function(){i.readyState!==i.DONE&&i.abort()},isFinished:function(){return i.readyState===i.DONE}}},n);function n(e){void 0===e&&(e=15e3),this.defaultTimeOut=e,this._createXmlHttpRequest=function(){return new XMLHttpRequest}}r.XhrDownloader=i;var o=(a.prototype.start=function(t,r){var i=this,n={count:this.defaultRetry},o={cancel:function(){},isFinished:function(){return!1}},a=function(){var e=i.baseDownloader.start(t,function(e,t){null!=e?--n.count<=0?r(e,t):setTimeout(function(){return a()},0):r(null,t)});o.cancel=e.cancel,o.isFinished=e.isFinished};return setTimeout(function(){return a()},0),o},a);function a(e,t){void 0===e&&(e=new i),void 0===t&&(t=2),this.baseDownloader=e,this.defaultRetry=t}r.RetryDownloader=o},{}],6:[function(e,t,r){"use strict";var i;function n(r){return function(e){var t=new Error(r);return t.name=r,t.cause=e,t}}Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorFactory=void 0,(i=r.ErrorFactory||(r.ErrorFactory={})).createInvalidOperationError=n("InvalidOperation"),i.createGameDriverError=n("GameDriverError"),i.createLoadMuduleError=n("LoadMuduleError"),i.createPlaylogError=n("PlaylogError"),i.createHttpRequestError=n("HttpRequestError"),i.createInvalidGameError=n("InvalidGameError"),i.createAbortGameError=n("AbortGameError"),i.createPostMessageError=n("PostMessageError"),i.createInsecureFrameUrlError=n("InsecureFrameUrlError")},{}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ExternalPluginManager=void 0;var i=e("@akashic/trigger"),n=(o.prototype.register=function(e){(this._externalPlugin[e.name]=e).implicit&&this._implicitPluginNames.push(e.name),e.onregister&&e.onregister(this),this.onRegister.fire(e)},o.prototype.find=function(e){return this._externalPlugin[e]},o.prototype.implicitPluginNames=function(){return this._implicitPluginNames},o);function o(){this.onRegister=new i.Trigger,this._externalPlugin={},this._implicitPluginNames=[]}r.ExternalPluginManager=n},{"@akashic/trigger":36}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ExternalPluginSignatureCaller=void 0;var i=(n.prototype.call=function(e,t,r){var i=this._trustedFunctionTable[e];i&&i(t,r)},n.prototype.setupFunctionTable=function(e,t,i,r){if("function"===e.type){if(null!=e.callbackProp){var n=e.callbackProp.match(/arguments\[(\d+)\]\.(.+)$/);if(null==n)throw new Error("invalid callbackProp geven");var o=parseInt(n[1],10),a=n[2];return void(this._trustedFunctionTable[r]=function(e,r){r&&(null!=e[o]?(e[o][a]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r(null,e)},t[i].apply(t,e)):(t[i].apply(t,e),r(null)))})}this._trustedFunctionTable[r]=function(e){return t[i].apply(t,e)}}else if("object"===e.type)for(var s=Object.keys(e.content),l=0;l<s.length;l++)this.setupFunctionTable(e.content[s[l]],t[i],s[l],r+":"+s[l])},n);function n(e,t){this._trustedFunctionTable=Object.create(null,{});for(var r=Object.keys(e.content),i=0;i<r.length;i++)this.setupFunctionTable(e.content[r[i]],t,r[i],r[i])}r.ExternalPluginSignatureCaller=i},{}],9:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.GameContent=void 0;var o,h=e("@akashic/akashic-gameview"),a=e("@cross-border-bridge/memory-queue"),s=e("@cross-border-bridge/memory-queue-data-bus"),l=e("./Content"),u=e("./DomElement"),c=e("./TrustedGameLoader"),p=e("./UntrustedGameLoader"),d=e("./utils"),_=e("./Error"),g=e("./CalcLayout"),f=(o=l.Content,n(m,o),m.prototype.start=function(e,t){var r=this;this._loadStartTime=(new Date).getTime(),this._gameViewShared=e,this._gameContentShared=t,this._customizer&&null!=this._customizer.overwriteEngineConfig?setTimeout(function(){return r._start_createElement(r._customizer.overwriteEngineConfig)},0):this._gameViewShared.downloader.start(this._contentUrl,function(e,t){e?r._fireError(_.ErrorFactory.createHttpRequestError(e)):r._start_createElement(t)})},m.prototype._parseEngineConfig=function(e){var t;try{t=JSON.parse(e)}catch(e){return this._fireError(_.ErrorFactory.createInvalidGameError(e)),null}return null==t.engine_urls&&(t.engine_urls=[]),null==t.external&&(t.external=[]),t},m.prototype._start_createElement=function(e){var t=this;if(!this._destroyed){var r=this._gameContentShared,i=this._engineConfig=this._parseEngineConfig(e);if(i){var n=i.untrusted,o=this._givenUntrusted;this._untrusted=!0===o||null==o&&!0===n,this._element=new u.GameContentElement(r.gameViewElement,this._untrusted?this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl:null,function(e){return t._start_startLoader(e)}),this._element.addDroppedDomEventListener(this._handleDroppedDomEvent_bound),null==this._contentArea&&this.setContentArea({x:0,y:0,width:r.viewWidth,height:r.viewHeight}),null==this._zIndex&&this.setZIndex(++r.largestZIndex),null==this._dataBus&&this._initDataBus()}}},m.prototype._start_startLoader=function(e){var o=this;if(!this._destroyed){var t=this._engineConfig;if(this._untrusted){var r=this._getUntrustedFrameHostname(),i=window.location.hostname;if(!r||""!==i&&0===r.indexOf(i))return void this._fireError(_.ErrorFactory.createInsecureFrameUrlError());var n=this._element.getContentWindow(),a=this._getUntrustedTargetOrigin();this._loader=new p.UntrustedGameLoader({engineConfig:t,shared:this._gameViewShared,customizer:this._customizer,audioPdiHandler:this._audioPdiHandlers,contentWindow:n,targetOrigin:a})}else this._loader=new c.TrustedGameLoader({engineConfig:t,shared:this._gameViewShared,customizer:this._customizer,audioPdiHandler:this._audioPdiHandlers});for(var s={},l=0;l<this._engineConfig.external.length;l++){var u=this._gameViewShared.pluginManager.find(this._engineConfig.external[l]);u&&u.untrustedSignature&&(s[u.name]=u.untrustedSignature)}var d={type:"object",content:s};this._loader.start({parentHtmlElement:e,contentUrl:this._contentUrl,initialEvents:this._initialEvents,argument:this._argument,pause:this._pauseOnStart,player:this._player,playConfig:this._playConfig,gameCreatedHandler:function(r){if(o._loader){o._workaroundEngine(e),o._handleGameArgument(o._argument),o._naturalWidth=r.width,o._naturalHeight=r.height,o._contentLayoutNeedsUpdate=!0,o._isReplay=o._playConfig.executionMode===h.ExecutionMode.Replay,o._isDropEventNeedsUpdate=!0,o._isRunning=!0,o._update();var i=[],n=function(e){if(!(0<=i.indexOf(e))){var t=o._gameViewShared.pluginManager.find(e);if(null!=t){i.push(e),t.requires&&t.requires.forEach(n);try{t.onload(r,o.getPluginDataBus(),o)}catch(e){console.error(e)}}}};o._engineConfig.external.forEach(n),o._gameViewShared.pluginManager.implicitPluginNames().forEach(n),r.skippingChangedTrigger&&r.skippingChangedTrigger.handle(function(t){o._skippingListeners.forEach(function(e){return e.onSkip(t)})});var t=((new Date).getTime()-o._loadStartTime)/1e3;o._contentLoadListeners.forEach(function(e){return e.onLoad(t)})}},errorHandler:function(t){return o._errorListeners.forEach(function(e){return e.onError(t)})},gameFinishedHandler:function(){o._isRunning=!1},replayData:this._replayData||this._playConfig.replayData,externalPluginSignature:d})}},m.prototype._update=function(){if(null!=this._element){if(this._contentAreaNeedsUpdate||this._contentLayoutNeedsUpdate){this._element.setContentArea(this._contentArea),this._element.setContentLayout(this._contentLayout);var e={outerWidth:this._contentArea.width,outerHeight:this._contentArea.height,naturalWidth:this._naturalWidth,naturalHeight:this._naturalHeight,horizontalAlignment:this._contentLayout.horizontalAlignment,verticalAlignment:this._contentLayout.verticalAlignment},t=void 0;switch(this._contentLayout.scaleMode){case h.ScaleMode.AspectFit:t=g.calcAspectFitLayout(e);break;case h.ScaleMode.Fill:t=g.calcFillLayout(e);break;default:t=g.calcNoneLayout(e)}this._element.setInnerSize(t),this._isRunning&&this._loader&&(!this._loader.resizablePrimarySurface||t.width===this._naturalWidth&&t.height===this._naturalHeight||this._requestResizePrimarySurface(t.width,t.height),this._loader.setScale(t.width/this._naturalWidth,t.height/this._naturalHeight)),this._contentAreaNeedsUpdate=!1,this._contentLayoutNeedsUpdate=!1}this._zIndexNeedsUpdate&&(this._element.setZIndex(this._zIndex),this._gameContentShared.largestZIndex=Math.max(this._gameContentShared.largestZIndex,this._zIndex),this._zIndexNeedsUpdate=!1),this._visibilityNeedsUpdate&&(this._element.setVisibility(this._visibility),this._visibilityNeedsUpdate=!1),this._isDropEventNeedsUpdate&&(this._updateDropEvent(),this._isDropEventNeedsUpdate=!1)}},m.prototype._initDataBus=function(){var e=new a.MemoryQueue,t=new a.MemoryQueue,r=new s.MemoryQueueDataBus(t,e),i=new s.MemoryQueueDataBus(e,t);this._dataBus=r,this._pluginDataBus=i},m.prototype.destroy=function(){this._destroyed||(this._loader&&(this._loader.stopGame(),this._loader=void 0),this._pluginDataBus&&(this._pluginDataBus.destroy(),this._pluginDataBus=void 0),this._dataBus&&(this._dataBus.destroy(),this._dataBus=void 0),this._element&&(this._element.destroy(),this._element=void 0),this._destroyed=!0,this._cancelResizePrimarySurface(),o.prototype.destroy.call(this))},m.prototype.pause=function(){this._loader?this._loader.pauseGame():this._fireInvalidOperationError("pause")},m.prototype.resume=function(){this._loader?this._loader.resumeGame():this._fireInvalidOperationError("resume")},m.prototype.isPaused=function(){return this._loader?this._loader.isPaused():!!this._pauseOnStart},m.prototype.setEventDropPolicy=function(e){this._loader||this._fireInvalidOperationError("setEventDropPolicy"),this._eventDropPolicy!==e&&(this._eventDropPolicy=e,this._isDropEventNeedsUpdate=!0,this._update())},m.prototype.getEventDropPolicy=function(){var e;return this._loader?null!==(e=this._eventDropPolicy)&&void 0!==e?e:h.EventDropPolicy.InReplay:null},m.prototype.setExecutionMode=function(e){this._loader&&this._loader.setExecutionMode(e)||this._fireInvalidOperationError("setExecutionMode");var t=e===h.ExecutionMode.Replay;this._isReplay!==t&&(this._isReplay=t,this._isDropEventNeedsUpdate=!0),this._update()},m.prototype.getExecutionMode=function(){return this._loader?this._loader.getExecutionMode():null},m.prototype.setReplayTargetTimeFunc=function(e){this._loader&&this._loader.setReplayTargetTimeFunc(e)||this._fireInvalidOperationError("setReplayTargetTimeFunc")},m.prototype.getReplayTargetTimeFunc=function(){return this._loader?this._loader.getReplayTargetTimeFunc():null},m.prototype.setReplayOriginDate=function(e){this._loader&&this._loader.setReplayOriginDate(e)||this._fireInvalidOperationError("setReplayOriginDate")},m.prototype.getReplayOriginDate=function(){return this._loader?this._loader.getReplayOriginDate():null},m.prototype.getAverageFramePerSecond=function(e){var t=this;this._loader?setTimeout(function(){return e(t._loader?t._loader.fps:0)},0):this._fireInvalidOperationError("getAverageFramePerSecond")},m.prototype.addSkippingListener=function(e){this._skippingListeners.addItem(e)},m.prototype.removeSkippingListener=function(e){this._skippingListeners.removeItem(e)},m.prototype.addDroppedEventListener=function(e){this._droppedListeners.addItem(e)},m.prototype.removeDroppedEventListener=function(e){this._droppedListeners.removeItem(e)},m.prototype.sendEvents=function(e){this._loader?this._loader.sendEvents(e):this._fireInvalidOperationError("sendEvents")},m.prototype.getPlayOriginDate=function(){return this._loader?this._loader.getPlayOriginDate():null},m.prototype.getGameVars=function(e,t){this._loader?this._loader.getGameVars(e,t):this._fireInvalidOperationError("getGameVars")},m.prototype.getGame=function(){if(this._loader)return this._loader.game;this._fireInvalidOperationError("getGame")},m.prototype.getGameDriver=function(){if(this._loader)return this._loader.driver;this._fireInvalidOperationError("getGameDriver")},m.prototype.getPluginDataBus=function(){return this._pluginDataBus},m.prototype.dumpPlaylog=function(){return this._loader.dumpPlaylog()},m.prototype.getGameContentSize=function(){var e=this.getGame();return{width:e.width,height:e.height}},m.prototype.setGameContentSize=function(e){if(this._loader)return this._loader.resetPrimarySurface(e.width,e.height),this._naturalWidth=e.width,void(this._naturalHeight=e.height);this._fireInvalidOperationError("setGameContentSize")},m.prototype.getMasterVolume=function(){if(this._loader)return this._loader.getMasterVolume();this._fireInvalidOperationError("getMasterVolume")},m.prototype.setMasterVolume=function(e){this._loader?this._loader.setMasterVolume(e):this._fireInvalidOperationError("setMasterVolume")},m.prototype._fireInvalidOperationError=function(e){this._fireError(_.ErrorFactory.createInvalidOperationError(e))},m.prototype._fireError=function(t){this._errorListeners.forEach(function(e){return e.onError(t)})},m.prototype._getUntrustedTargetOrigin=function(){if(null!=this._untrustedFrameTargetOrigin)return this._untrustedFrameTargetOrigin;if(!this._untrustedFrameUrl&&null!=this._gameViewShared.untrustedFrameTargetOrigin)return this._gameViewShared.untrustedFrameTargetOrigin;var e=(this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl).match(/^(https?:\/\/[^\/]*)\//);return e&&e[1]?e[1]:null},m.prototype._getUntrustedFrameHostname=function(){var e=(this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl).match(/^https?:\/\/([^\/:]*)(?::\d+)?\//);return e&&e[1]?e[1]:null},m.prototype._workaroundEngine=function(e){for(var t=e.getElementsByClassName("input-handler"),r=0;r<t.length;++r)t[r].setAttribute("tabindex","0")},m.prototype._handleGameArgument=function(e){e&&e.agv&&e.agv.disableDropEventInReplay&&void 0===this._eventDropPolicy&&(this._eventDropPolicy=h.EventDropPolicy.Never,this._isDropEventNeedsUpdate=!0)},m.prototype._requestResizePrimarySurface=function(e,t){var r=this;if(this._bufferingNaturalWidth=Math.ceil(e),this._bufferingNaturalHeight=Math.ceil(t),this._lastUpdatePrimarySurfaceSizeTime=Date.now(),null==this._updatePrimarySurfaceSizeTimeoutId){var i=function(){Date.now()<r._lastUpdatePrimarySurfaceSizeTime+r._updatePrimarySurfaceSizeDelay?r._updatePrimarySurfaceSizeTimeoutId=window.setTimeout(i,r._updatePrimarySurfaceSizeDelay):(r._naturalWidth=r._bufferingNaturalWidth,r._naturalHeight=r._bufferingNaturalHeight,r._bufferingNaturalWidth=null,r._bufferingNaturalHeight=null,r._loader.setScale(1,1),r._loader.resetPrimarySurface(r._naturalWidth,r._naturalHeight),r._updatePrimarySurfaceSizeTimeoutId=null)};this._updatePrimarySurfaceSizeTimeoutId=window.setTimeout(i,this._updatePrimarySurfaceSizeDelay)}},m.prototype._cancelResizePrimarySurface=function(){null!=this._updatePrimarySurfaceSizeTimeoutId&&(window.clearTimeout(this._updatePrimarySurfaceSizeTimeoutId),this._updatePrimarySurfaceSizeTimeoutId=null)},m.prototype._handleDroppedDomEvent=function(e,t){var r={type:e,reason:h.DroppedEventReason.Replay};this._droppedListeners.forEach(function(e){return e(r)})},m.prototype._updateDropEvent=function(){var e,t=null!==(e=this._eventDropPolicy)&&void 0!==e?e:h.EventDropPolicy.InReplay,r=t===h.EventDropPolicy.Always||t===h.EventDropPolicy.InReplay&&this._isReplay;this._element.setDropDomEvent(r)},m);function m(e){var t,r=o.call(this,e,"game")||this;return r._skippingListeners=new d.ObjectList,r._droppedListeners=new d.ObjectList,r._loadStartTime=0,r._loader=null,r._element=null,r._isRunning=!1,r._isReplay=!1,r._naturalWidth=0,r._naturalHeight=0,r._bufferingNaturalWidth=null,r._bufferingNaturalHeight=null,r._updatePrimarySurfaceSizeTimeoutId=null,r._lastUpdatePrimarySurfaceSizeTime=null,r._updatePrimarySurfaceSizeDelay=1e3,r._untrusted=!1,r._replayData=null,r._engineConfig=null,r._destroyed=!1,r._eventDropPolicy=void 0,r._isDropEventNeedsUpdate=!1,r._handleDroppedDomEvent_bound=r._handleDroppedDomEvent.bind(r),r._contentUrl=e.contentUrl,r._player=e.player,r._playConfig=e.playConfig,r._untrustedFrameUrl=e.untrustedFrameUrl,r._untrustedFrameTargetOrigin=e.untrustedFrameTargetOrigin,r._argument=e.argument,r._pauseOnStart=e.pause,r._initialEvents=e.initialEvents,r._givenUntrusted=e.untrusted,r._customizer=e.gameLoaderCustomizer,r._audioPdiHandlers=e.audioPdiHandlers,r._eventDropPolicy=null!==(t=e.eventDropPolicy)&&void 0!==t?t:void 0,r}r.GameContent=f},{"./CalcLayout":2,"./Content":3,"./DomElement":4,"./Error":6,"./TrustedGameLoader":13,"./UntrustedGameLoader":15,"./utils":27,"@akashic/akashic-gameview":28,"@cross-border-bridge/memory-queue":38,"@cross-border-bridge/memory-queue-data-bus":37}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ScriptManager=void 0;var i=(n._addScriptElement=function(e,t){var r=document.createElement("script");r.src=e,r.addEventListener("load",function(){t(null)}),r.addEventListener("error",function(){t(new Error("failed to load script: "+e))}),document.head.appendChild(r)},n.prototype.appendScripts=function(e,r){var i=this,n=[],o=e.length;o?e.forEach(function(t){i._appendScript(t,function(e){e&&n.push(t),0<--o||(0===n.length?r(null):r(new Error("failed to load scripts: "+n.join(", "))))})}):setTimeout(function(){return r(null)},0)},n.prototype._appendScript=function(r,e){var i=this;this._loadedTable[r]?setTimeout(function(){return e(null)},0):this._loadingTable[r]?this._loadingTable[r].push(e):(this._loadingTable[r]=[e],this._loadFunc(r,function(t){t||(i._loadedTable[r]=!0);var e=i._loadingTable[r];delete i._loadingTable[r],e.forEach(function(e){return e(t)})}))},n);function n(e){this._loadedTable=Object.create(null),this._loadingTable=Object.create(null),this._loadFunc=e||n._addScriptElement}r.ScriptManager=i},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SessionManager=void 0;var i=(n.prototype.isInitialized=function(){return!!this._playlogClient},n.prototype.initialize=function(e){this._playlogClient=e},n.prototype.setSocketOptions=function(e){this._socketOpts=e},n.prototype.getSession=function(r,e,t,i){var n=this;if(this._playlogClient){var o=this._activeSessionTable[r];if(null!=o)return++o.refCount,void setTimeout(function(){i(null,o.session,!1)},0);var a=this._playlogClient.Socket.Type.WebSocket,s=new this._playlogClient.Session(r,{socketType:a,validationData:t,socketOpts:this._socketOpts});s.on("error",function(t){var e=n._activeSessionTable[r];null!=e&&e.errorHandlers.forEach(function(e){return e(t)})}),s.open(function(e){e?setTimeout(function(){i(e,null,!0)},0):(n._activeSessionTable[r]={session:s,refCount:1,errorHandlers:[]},setTimeout(function(){i(null,s,!0)},0))})}else setTimeout(function(){return i(new Error("playlog-client not initialized"),null,!0)})},n.prototype.addErrorHandler=function(e,t){var r=this._activeSessionTable[e];null!=r&&r.errorHandlers.push(t)},n.prototype.removeErrorHandler=function(e,t){var r=this._activeSessionTable[e];null!=r&&(r.errorHandlers=r.errorHandlers.filter(function(e){return e!==t}))},n.prototype.releaseSession=function(e){var t=this._activeSessionTable[e];null!=t&&--t.refCount<1&&(t.session.close(function(){}),this._activeSessionTable[e]=null)},n);function n(){this._activeSessionTable={},this._playlogClient=null,this._socketOpts=null}r.SessionManager=i},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GameContentSharedObject=r.GameViewSharedObject=void 0;var i=e("./ExternalPluginManager"),n=e("./SessionManager"),o=e("./Downloader"),a=e("./ScriptManager"),s=e("./bridge/PostMessageBridgeDemux"),l=(u.prototype.destroy=function(){this.pluginManager=null,this.sessionManager=null,this.scriptManager=null,(this.downloader=null)!=this.bridgeDemux&&this.bridgeDemux.destroy(),this.bridgeDemux=null},u.prototype.destroyed=function(){return null==this.bridgeDemux},u);function u(e){this.pluginManager=new i.ExternalPluginManager,this.sessionManager=new n.SessionManager,this.scriptManager=new a.ScriptManager,this.downloader=new o.RetryDownloader(e?e.baseDownloader:void 0),this.bridgeDemux=new s.PostMessageBridgeDemux(e.window||window,e.trustedChildOrigin),this.untrustedFrameUrl=e.untrustedFrameUrl,this.untrustedFrameTargetOrigin=e.untrustedFrameTargetOrigin||null}r.GameViewSharedObject=l;function d(e){this.gameViewElement=e.gameViewElement,this.largestZIndex=0,this.viewWidth=e.gameViewWidth,this.viewHeight=e.gameViewHeight}r.GameContentSharedObject=d},{"./Downloader":5,"./ExternalPluginManager":7,"./ScriptManager":10,"./SessionManager":11,"./bridge/PostMessageBridgeDemux":21}],13:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.TrustedGameLoader=void 0;var o,a=e("./Error"),s=e("./TrustedGameLoaderBase"),l=(o=s.TrustedGameLoaderBase,n(u,o),u.prototype._getAdditionalScripts=function(e){var r=this,i=[];return 0===e.external.length||e.external.forEach(function(e){var t=r._shared.pluginManager.find(e);null!=t&&null!=t.scriptUrls&&t.scriptUrls.forEach(function(e){return i.push(e)})}),i},u.prototype._loadScripts=function(e,t){this._shared.scriptManager.appendScripts(e,t)},u.prototype._initializeSessionManagerIfNeeded=function(e){e&&!this._shared.sessionManager.isInitialized()&&this._shared.sessionManager.initialize(e)},u.prototype._acquirePlaylogClientAMFlow=function(i,n){var o=this;this._shared.sessionManager.getSession(i.playlogServerUrl,i.protocol,{playId:i.playId,token:i.playToken},function(e,t,r){e?n(e,null):(o._shared.sessionManager.addErrorHandler(i.playlogServerUrl,o._onSessionManagerError_bound),t.createClient({usePrimaryChannel:r},n))})},u.prototype._releasePlaylogClientAMFlow=function(e){this._shared.sessionManager.removeErrorHandler(this._playlogServerUrl,this._onSessionManagerError_bound),this._shared.sessionManager.releaseSession(this._playlogServerUrl),this._onSessionManagerError_bound=null},u.prototype._onSessionManagerError=function(e){this._param.errorHandler(a.ErrorFactory.createPlaylogError(e))},u);function u(e){var t=o.call(this,e)||this;return t._shared=e.shared,t._onSessionManagerError_bound=t._onSessionManagerError.bind(t),t}r.TrustedGameLoader=l},{"./Error":6,"./TrustedGameLoaderBase":14}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrustedGameLoaderBase=void 0;var a=e("@akashic/akashic-gameview"),s=e("./Error"),l=e("./detectEngineFileObject"),i=e("./createProxyAudioPluginClass"),n=(o.prototype.start=function(e){this._param=e,this._isPaused=!!e.pause,this._downloadScripts()},o.prototype._downloadScripts=function(){var n=this,e=this._getAdditionalScripts(this._engineConfig),o=this._engineConfig.engine_urls.concat(e),t=o.filter(function(e){return!(l.isEngineFilesUrl(e)&&l.detectEngineFilesObject(e)||l.isPlaylogClientUrl(e)&&l.detectPlaylogClientObject(e))});this._loadScripts(t,function(e){if(e)n._param.errorHandler(s.ErrorFactory.createHttpRequestError(e));else{var t=l.detectRuntimes(o),r=t[0],i=t[1];!r&&i?(n._g=i.g,n._GameDriver=i.GameDriver,n._PdiBrowser=i.PdiBrowser,n._initializeSessionManagerIfNeeded(i.PlaylogClient),n._playId=n._param.playConfig.playId,n._agvExecutionMode=n._param.playConfig.executionMode,n.isTestbed="playlogServerUrl"in n._param.playConfig,n._param.replayData?setTimeout(function(){return n._startReplayGame()},0):n.isTestbed?setTimeout(function(){return n._startPlaylogGame()},0):setTimeout(function(){return n._startStandaloneGame()},0)):n._param.errorHandler(r)}})},o.prototype._startReplayGame=function(){var e=this;if(this._amflowClient=new this._GameDriver.MemoryAmflowClient({playId:this._playId,tickList:this._param.replayData.tickList,startPoints:this._param.replayData.startPoints}),this._param.playConfig.replayTargetTimeFunc&&this._param.replayData.startPoints&&this._param.replayData.startPoints[0]){var t=this._param.replayData.startPoints[0].timestamp,r=this._param.playConfig.replayTargetTimeFunc();null!=this._param.playConfig.replayOriginDate&&(r+=this._param.playConfig.replayOriginDate),this._replayOriginDateOffset=t-r}setTimeout(function(){return e._startGame()},0)},o.prototype._startStandaloneGame=function(){var e=this;this._customizer&&this._customizer.createCustomAmflowClient?(this._amflowClient=this._customizer.createCustomAmflowClient(),this._usingCustomAmflow=!0):this._amflowClient=new this._GameDriver.MemoryAmflowClient({playId:this._playId}),setTimeout(function(){return e._startGame()},0)},o.prototype._startPlaylogGame=function(){var r=this,e=this._param.playConfig;this._playToken=e.playToken,this._playlogServerUrl=e.playlogServerUrl,this._protocol=e.protocol||a.ProtocolType.WebSocket,this._customizer&&this._customizer.createCustomAmflowClient?(this._amflowClient=this._customizer.createCustomAmflowClient(),this._usingCustomAmflow=!0,setTimeout(function(){return r._startGame()},0)):this._acquirePlaylogClientAMFlow({playlogServerUrl:this._playlogServerUrl,protocol:this._protocol,playId:this._playId,playToken:this._playToken},function(e,t){e?r._param.errorHandler(s.ErrorFactory.createPlaylogError(e)):(r._amflowClient=t,r._startGame())})},o.prototype._startGame=function(){var t=this,e=this._createPlatform(),r=this._createGameDriver(e);r.gameCreatedTrigger.handle(function(e){t.game=e,"abortTrigger"in t.game&&t.game.abortTrigger.handle(function(){t._param.errorHandler(s.ErrorFactory.createAbortGameError())}),t._param.gameCreatedHandler(e)}),this.driver=r,this.platform=e,setTimeout(function(){return t._startGameDriver(r)},0)},o.prototype._createPlatform=function(){var i=this,e=null;try{var t=this._PdiBrowser,r={amflow:this._amflowClient,containerView:this._param.parentHtmlElement,audioPlugins:this._createAudioPlugins()};this._overwritePlatformParameter(r),e=new t.Platform(r),this._customizer&&this._customizer.platformCustomizer&&this._customizer.platformCustomizer(e,{g:this._g}),this._rawLoadGameConfiguration=e.loadGameConfiguration,e.loadGameConfiguration=function(e,r){i._customLoadGameConfiguration(e,function(e,t){t.environment&&t.environment.surface&&t.environment.surface.resizablePrimary&&(i.resizablePrimarySurface=!0),r(e,t)})}}catch(e){return void this._param.errorHandler(s.ErrorFactory.createLoadMuduleError(e))}return e},o.prototype._customLoadGameConfiguration=function(e,t){var r=this,i="<agvw-queryparam>",n="<agvw-configuration>";if(e!==i)e!==n?-1===this._param.contentUrl.indexOf("?")?this._rawLoadGameConfiguration(e,t):setTimeout(function(){return t(null,{definitions:[{url:n,basePath:r._getAssetBase()},i]})},0):this._rawLoadGameConfiguration(this._engineConfig.content_url,t);else{var o=this._param.contentUrl.slice(this._param.contentUrl.indexOf("?")+1).split("&").reduce(function(e,t){var r=t.split("=");try{e[r[0]]=JSON.parse(decodeURIComponent(r[1]))}catch(e){}return e},{});setTimeout(function(){return t(null,o)},0)}},o.prototype._createGameDriver=function(e){var t=this;return new this._GameDriver.GameDriver({platform:e,player:this._param.player,errorHandler:function(e){return t._param.errorHandler(s.ErrorFactory.createGameDriverError(e))}})},o.prototype._startGameDriver=function(e){var t=this;this.driver.initialize(this._createInitializeParameter(),function(e){e?t._param.errorHandler(s.ErrorFactory.createGameDriverError(e)):(t._param.replayData||t._sendinitialEvents(),t._isPaused||t.driver.startGame(),t._isLoadEnded=!0,t._destroyed&&t.stopGame())})},o.prototype._createInitializeParameter=function(){var e=this._agvExecutionMode===a.ExecutionMode.Active&&!this._param.replayData,t=!!this._param.replayData||this._agvExecutionMode===a.ExecutionMode.Replay,r=this._isPaused,i=e?this._GameDriver.ExecutionMode.Active:this._GameDriver.ExecutionMode.Passive,n=null!=this._param.playConfig.replayOriginDate?this._param.playConfig.replayOriginDate+this._replayOriginDateOffset:this._replayOriginDateOffset,o=t?this._createLoopConfigurationForReplay(this._param.playConfig.replayTargetTimeFunc,n):this._createLoopConfigurationForRealtime(this._param.playConfig.replayTargetTimeFunc,n);return{configurationUrl:this._engineConfig.content_url,assetBase:this._getAssetBase(),profiler:this._getProfiler(),gameArgs:this._param.argument,driverConfiguration:{playId:this._playId,playToken:this._playToken,executionMode:i,eventBufferMode:{isSender:!r&&!e&&!t,isReceiver:e,isDiscarder:r}},loopConfiguration:o}},o.prototype._getAssetBase=function(){var e=this._engineConfig.asset_base_url;if(null==e){var t=this._engineConfig.content_url;e=t.substr(0,t.lastIndexOf("/"))+"/"}return e},o.prototype._getProfiler=function(){var t=this,e=null;return this._GameDriver.SimpleProfiler&&(e=new this._GameDriver.SimpleProfiler({interval:200,getValueHandler:function(e){t.fps=e.framePerSecond.ave}})),e},o.prototype._sendinitialEvents=function(){var t=this;if(this._param.initialEvents)try{this._param.initialEvents.forEach(function(e){return t._amflowClient.sendEvent(e)})}catch(e){this._param.errorHandler(s.ErrorFactory.createPlaylogError(e))}},o.prototype.pauseGame=function(){this._isPaused||(this._isPaused=!0,this._isLoadEnded&&(this.driver._eventBuffer.setMode({isSender:!1,isDiscarder:!0}),this.driver.stopGame(),this.game._setMuted(!0)))},o.prototype.resumeGame=function(){if(this._isPaused&&(this._isPaused=!1,this._isLoadEnded)){this.driver.startGame();var e=this._agvExecutionMode===a.ExecutionMode.Active,t=this._agvExecutionMode===a.ExecutionMode.Replay;this.driver._eventBuffer.setMode({isSender:!e&&!t,isDiscarder:!1}),this.game._setMuted(!1)}},o.prototype.isPaused=function(){return this._isPaused},o.prototype.stopGame=function(){var e=this;this._destroyed=!0,this._isLoadEnded&&(this.game&&this.game.audio&&(this.game.audio.stopAll?this.game.audio.stopAll():(this.game.audio.music.stopAll(),this.game.audio.sound.stopAll()),this.game.audio.music.stopAll(),this.game.audio.sound.stopAll()),this.driver.stopGame(),this.driver.initialize({driverConfiguration:{playId:null},configurationUrl:null},function(){e.isTestbed&&!e._usingCustomAmflow&&e._releasePlaylogClientAMFlow(e._playlogServerUrl),e._amflowClient=null,e._g=null,e._GameDriver=null,e._PdiBrowser=null,e.game=null,e.platform=null,e.driver.destroy?e.driver.destroy().then(function(){return e._param.gameFinishedHandler()}):setTimeout(function(){return e._param.gameFinishedHandler()})}))},o.prototype.sendEvents=function(e){var t=this;try{this.driver._eventBuffer&&this.driver._eventBuffer.onEvent?e.forEach(function(e){return t.driver._eventBuffer.onEvent(e)}):e.forEach(function(e){return t._amflowClient.sendEvent(e)})}catch(e){this._param.errorHandler(s.ErrorFactory.createPlaylogError(e))}},o.prototype.dumpPlaylog=function(){return this.isTestbed||!this._amflowClient.dump?null:this._amflowClient.dump()},o.prototype.getGameVars=function(e,t){var r=this;setTimeout(function(){r.game&&t(r.game.vars&&r.game.vars[e])},0)},o.prototype.setExecutionMode=function(e){if(!this.driver)return!1;if(!this.driver._gameLoop||!this.driver._eventBuffer)return!1;if(this._agvExecutionMode===e)return!0;this._agvExecutionMode=e;var t=this._agvExecutionMode===a.ExecutionMode.Active,r=!!this._param.replayData||this._agvExecutionMode===a.ExecutionMode.Replay,i=t?this._GameDriver.ExecutionMode.Active:this._GameDriver.ExecutionMode.Passive,n=r?this._createLoopConfigurationForReplay():this._createLoopConfigurationForRealtime();return this.driver._gameLoop.setExecutionMode(i),this.driver._gameLoop.setLoopConfiguration(n),this.driver._eventBuffer.setMode({isSender:!t&&!r,isReceiver:t}),!0},o.prototype._createLoopConfigurationForRealtime=function(e,t){return{loopMode:this._GameDriver.LoopMode.Realtime,delayIgnoreThreshold:o.REALTIME_DELAY_IGNORE_THRESHOLD,jumpTryThreshold:o.REALTIME_JUMP_TRY_THRESHOLD,targetTimeFunc:e,originDate:t}},o.prototype._createLoopConfigurationForReplay=function(e,t){return{loopMode:this._GameDriver.LoopMode.Replay,delayIgnoreThreshold:Number.MAX_VALUE,jumpTryThreshold:Number.MAX_VALUE,targetTimeFunc:e,originDate:t}},o.prototype.getExecutionMode=function(){return this._agvExecutionMode},o.prototype.setReplayTargetTimeFunc=function(e){return!(!this.driver||!this.driver._gameLoop||(this.driver._gameLoop.setLoopConfiguration({targetTimeFunc:e}),0))},o.prototype.getReplayTargetTimeFunc=function(){if(!this.driver)return null;var e=this.driver.getLoopConfiguration();return e?e.targetTimeFunc:null},o.prototype.setReplayOriginDate=function(e){return!(!this.driver||!this.driver._gameLoop||(this.driver._gameLoop.setLoopConfiguration({originDate:e+this._replayOriginDateOffset}),0))},o.prototype.getReplayOriginDate=function(){if(!this.driver)return null;var e=this.driver.getLoopConfiguration();return e?e.originDate:null},o.prototype.getPlayOriginDate=function(){if(!this.driver||!this.driver._gameLoop)return null;var e=this.driver._gameLoop._startedAt;return e||null},o.prototype.getReplayOriginDateOffset=function(){return this._replayOriginDateOffset},o.prototype.resetPrimarySurface=function(e,t){var r=this.driver;r&&r.resetPrimarySurface&&r.resetPrimarySurface(e,t)},o.prototype.setScale=function(e,t){this.platform.setScale(e,t)},o.prototype.setMasterVolume=function(e){this.platform.setMasterVolume(e)},o.prototype.getMasterVolume=function(){return this.platform.getMasterVolume()},o.prototype._overwritePlatformParameter=function(e){},o.prototype._createAudioPlugins=function(){var e=this._PdiBrowser;return this._customizer&&this._customizer.createCustomAudioPlugins?this._customizer.createCustomAudioPlugins():this._audioPdiHandler?[i.createProxyAudioPluginClass(this._g,this._audioPdiHandler)]:[e.WebAudioPlugin,e.HTMLAudioPlugin]},o.REALTIME_DELAY_IGNORE_THRESHOLD=6,o.REALTIME_JUMP_TRY_THRESHOLD=3e4,o);function o(e){this._playId=null,this._playToken="",this._agvExecutionMode=null,this._playlogServerUrl="",this._protocol=a.ProtocolType.WebSocket,this._amflowClient=null,this._g=null,this._GameDriver=null,this._PdiBrowser=null,this._usingCustomAmflow=!1,this._rawLoadGameConfiguration=null,this._isLoadEnded=!1,this._isPaused=!1,this._engineConfig=null,this._destroyed=!1,this.isTestbed=!1,this.game=null,this.driver=null,this.platform=null,this.fps=0,this.resizablePrimarySurface=!1,this._replayOriginDateOffset=0,this._customizer=e.customizer,this._engineConfig=e.engineConfig,this._audioPdiHandler=e.audioPdiHandler}r.TrustedGameLoaderBase=n},{"./Error":6,"./createProxyAudioPluginClass":25,"./detectEngineFileObject":26,"@akashic/akashic-gameview":28}],15:[function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.UntrustedGameLoader=r.GameDriverProxy=r.GameProxy=void 0;var s=e("@akashic/akashic-gameview"),n=e("@akashic/trigger"),o=e("./Error"),a=e("./detectEngineFileObject"),l=e("./bridge/LoaderMessage"),u=e("./bridge/setupAMFlowProxy"),d=e("./bridge/setupAudioPdiProxy"),h=e("./ExternalPluginSignatureCaller"),c=function(e){this.playId=e.playId,this.width=e.width,this.height=e.height,this.fps=e.fps,this.external={},this.skippingChangedTrigger=new n.Trigger,this._started=new n.Trigger,this._loaded=new n.Trigger};r.GameProxy=c;var p=(_.prototype.changeState=function(e,t){this._bridge.request(l.LoaderMessage.ChangeDriverState,e,function(e){t(e&&"string"==typeof e?o.ErrorFactory.createGameDriverError(e):null)})},_);function _(e){this._bridge=e}r.GameDriverProxy=p;var g=(f.prototype.start=function(e){var r=this;this._param=e,this._isPaused=!!e.pause,this._replayTargetTimeFunc=e.playConfig.replayTargetTimeFunc,this._shared.bridgeDemux.register(this._contentWindow,this._targetOrigin,function(e,t){e?r._param.errorHandler(o.ErrorFactory.createPostMessageError(e)):(r._bridge=t,r._bridge.on(l.LoaderMessage.Error,function(e){return r._fireErrorTriggerIfNeeded(e)}),r._bridge.on(l.LoaderMessage.GameCreated,r._handleGameCreated_bound),r._bridge.on(l.LoaderMessage.AcquireAMFlow,r._handleAcquireAMFlow_bound),r._bridge.on(l.LoaderMessage.PlayOriginDate,r._handlePlayOriginDate_bound),r._bridge.on(l.LoaderMessage.ExternalSend,r._handleExternalSend_bound),r._bridge.on(l.LoaderMessage.External,r._handleExternalPlugin_bound),r._bridge.on(l.LoaderMessage.SkippingChanged,r._handleSkippingChanged_bound),r._bridge.on(l.LoaderMessage.GameLoaded,r._handleGameLoaded_bound),r._bridge.on(l.LoaderMessage.GameStarted,r._handleGameStarted_bound),r._audioPdiHandler&&(r._teardownAudioPdiProxy=d.setupAudioPdiProxy(r._audioPdiHandler,r._bridge)),r._start_initializePlaylogClient())})},f.prototype._start_initializePlaylogClient=function(){var r=this;if(this._shared.sessionManager.isInitialized())this._start_request();else{var i=a.findPlaylogClientUrl(this._engineConfig.engine_urls);i?this._shared.scriptManager.appendScripts([i],function(e){if(e)r._param.errorHandler(o.ErrorFactory.createHttpRequestError(e));else{var t=a.detectPlaylogClientObject(i);t&&r._shared.sessionManager.initialize(t),r._start_request()}}):this._start_request()}},f.prototype._start_request=function(){var t=this,e=this._param;this._bridge.request(l.LoaderMessage.Start,{engineConfig:this._engineConfig,replayData:e.replayData,contentUrl:e.contentUrl,initialEvents:e.initialEvents,argument:e.argument,pause:this._isPaused,player:e.player,playConfig:i(i({},e.playConfig),{replayTargetTimeFunc:void 0}),proxyAudio:!!this._audioPdiHandler,externalPluginSignature:e.externalPluginSignature},function(e){return t._fireErrorTriggerIfNeeded(e)})},f.prototype.pauseGame=function(){this._isPaused||(this._isPaused=!0,this._bridge.send(l.LoaderMessage.PauseGame),this._updateTargetTimeNotifier())},f.prototype.resumeGame=function(){this._isPaused&&(this._isPaused=!1,this._bridge.send(l.LoaderMessage.ResumeGame),this._updateTargetTimeNotifier())},f.prototype.isPaused=function(){return this._isPaused},f.prototype.stopGame=function(){this._bridge&&(this._bridge.send(l.LoaderMessage.StopGame,null),this._teardownAudioPdiProxy&&this._teardownAudioPdiProxy(),this._releaseAMFlow(),this._bridge.destroy(),this._bridge=null,this._externalPluginCaller=null,this._handleSessionManagerError_bound=null,this._handleGameCreated_bound=null,this._handleAcquireAMFlow_bound=null,this._handlePlayOriginDate_bound=null,this._handleExternalSend_bound=null,this._handleExternalPlugin_bound=null,this._handleSkippingChanged_bound=null,this._handleGameLoaded_bound=null,this._handleGameStarted_bound=null,this._notifyTargetTime_bound=null,this._updateTargetTimeNotifier(),this._param.gameFinishedHandler())},f.prototype.sendEvents=function(e){this._bridge.send(l.LoaderMessage.SendEvents,e)},f.prototype.dumpPlaylog=function(){return null},f.prototype.getGameVars=function(e,r){var i=this;this._bridge.request(l.LoaderMessage.GetGameVars,e,function(e,t){if(!i._fireErrorTriggerIfNeeded(e))try{r(t)}catch(e){i._param.errorHandler(e)}})},f.prototype.setExecutionMode=function(e){return this._agvExecutionMode===e||(this._agvExecutionMode=e,this._bridge.send(l.LoaderMessage.SetExecutionMode,e),this._updateTargetTimeNotifier()),!0},f.prototype.getExecutionMode=function(){return this._agvExecutionMode},f.prototype.setReplayTargetTimeFunc=function(e){return this._replayTargetTimeFunc=e,this._updateTargetTimeNotifier(),!0},f.prototype.getReplayTargetTimeFunc=function(){return this._replayTargetTimeFunc},f.prototype.setReplayOriginDate=function(e){return this._replayOriginDate=e,this._bridge.send(l.LoaderMessage.SetReplayOriginDate,e),!0},f.prototype.getReplayOriginDate=function(){return this._replayOriginDate},f.prototype.getPlayOriginDate=function(){return this._playOriginDate},f.prototype.resetPrimarySurface=function(e,t){this._bridge.send(l.LoaderMessage.ResetSurface,{width:e,height:t})},f.prototype.setScale=function(e,t){this._bridge.send(l.LoaderMessage.SetScale,{xScale:e,yScale:t})},f.prototype.setMasterVolume=function(e){this._masterVolume!==e&&(this._masterVolume=e,this._bridge.send(l.LoaderMessage.SetMasterVolume,e))},f.prototype.getMasterVolume=function(){return this._masterVolume},f.prototype._fireErrorTriggerIfNeeded=function(e){return!(!e||"string"!=typeof e||(this._param.errorHandler(o.ErrorFactory.createGameDriverError(e)),0))},f.prototype._handleSessionManagerError=function(e){this._param.errorHandler(o.ErrorFactory.createPlaylogError(e))},f.prototype._releaseAMFlow=function(){if(this._teardownAMFlowProxy&&(this._teardownAMFlowProxy(),!this._usingCustomAmflow)){var e=this._param.playConfig.playlogServerUrl;this._shared.sessionManager.removeErrorHandler(e,this._handleSessionManagerError_bound),this._shared.sessionManager.releaseSession(e)}},f.prototype._handleGameCreated=function(e){if(this.game=new c(i(i({},e),{playId:this._param.playConfig.playId})),this.driver=new p(this._bridge),this._param.gameCreatedHandler(this.game),this._param.externalPluginSignature){var t=this._param.externalPluginSignature;this._externalPluginCaller=new h.ExternalPluginSignatureCaller(t,this.game.external)}this._updateTargetTimeNotifier()},f.prototype._handleAcquireAMFlow=function(e,t){function i(e){o._param.errorHandler(e),t(e.message)}function n(e){o._amflowClient=e,o._teardownAMFlowProxy=u.setupAMFlowProxy(e,o._bridge),t(null)}var o=this;if(this._customizer.createCustomAmflowClient)return this._usingCustomAmflow=!0,void n(this._customizer.createCustomAmflowClient());var a=this._param.playConfig;this._shared.sessionManager.getSession(a.playlogServerUrl,a.protocol||s.ProtocolType.WebSocket,{playId:a.playId,token:a.playToken},function(e,t,r){e?i(e):(o._shared.sessionManager.addErrorHandler(a.playlogServerUrl,o._handleSessionManagerError_bound),t.createClient({usePrimaryChannel:r},function(e,t){e?i(e):n(t)}))})},f.prototype._handlePlayOriginDate=function(e){"number"==typeof e&&(this._playOriginDate=e)},f.prototype._handleExternalSend=function(e){this.game.external&&this.game.external.send&&this.game.external.send(e)},f.prototype._handleExternalPlugin=function(e,t){this._externalPluginCaller&&this.game.external&&this._externalPluginCaller.call(e.identifier,e.args,t)},f.prototype._handleSkippingChanged=function(e){this.game.skippingChangedTrigger.fire(e)},f.prototype._handleGameLoaded=function(){this.game._loaded.fire()},f.prototype._handleGameStarted=function(){this.game._started.fire()},f.prototype._updateTargetTimeNotifier=function(){var e=this._agvExecutionMode!==s.ExecutionMode.Active,t=this.game&&e&&!this._isPaused&&this._replayTargetTimeFunc&&!!this._bridge;t&&!this._targetTimeNotifierTimer?this._targetTimeNotifierTimer=setInterval(this._notifyTargetTime_bound,this.game.fps):!t&&this._targetTimeNotifierTimer&&(clearInterval(this._targetTimeNotifierTimer),this._targetTimeNotifierTimer=null)},f.prototype._notifyTargetTime=function(){var e=this._replayTargetTimeFunc();this._bridge.send(l.LoaderMessage.TargetTime,e)},f);function f(e){this._agvExecutionMode=null,this._amflowClient=null,this._isPaused=!1,this._engineConfig=null,this.game=null,this.driver=null,this.fps=-1,this.resizablePrimarySurface=!1,this._teardownAudioPdiProxy=null,this._teardownAMFlowProxy=null,this._usingCustomAmflow=!1,this._shared=e.shared,this._customizer=e.customizer,this._audioPdiHandler=e.audioPdiHandler,this._engineConfig=e.engineConfig,this._targetOrigin=e.targetOrigin,this._contentWindow=e.contentWindow,this._replayTargetTimeFunc=null,this._replayOriginDate=0,this._playOriginDate=null,this._masterVolume=1,this._handleSessionManagerError_bound=this._handleSessionManagerError.bind(this),this._handleGameCreated_bound=this._handleGameCreated.bind(this),this._handleAcquireAMFlow_bound=this._handleAcquireAMFlow.bind(this),this._handlePlayOriginDate_bound=this._handlePlayOriginDate.bind(this),this._handleExternalSend_bound=this._handleExternalSend.bind(this),this._handleExternalPlugin_bound=this._handleExternalPlugin.bind(this),this._handleSkippingChanged_bound=this._handleSkippingChanged.bind(this),this._handleGameLoaded_bound=this._handleGameLoaded.bind(this),this._handleGameStarted_bound=this._handleGameStarted.bind(this),this._notifyTargetTime_bound=this._notifyTargetTime.bind(this)}r.UntrustedGameLoader=g},{"./Error":6,"./ExternalPluginSignatureCaller":8,"./bridge/LoaderMessage":19,"./bridge/setupAMFlowProxy":23,"./bridge/setupAudioPdiProxy":24,"./detectEngineFileObject":26,"@akashic/akashic-gameview":28,"@akashic/trigger":36}],16:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.WebContent=void 0;var o,a=e("@cross-border-bridge/post-message-data-bus"),s=e("./Content"),l=e("./DomElement"),u=(o=s.Content,n(d,o),d.prototype.start=function(e,t){var r=this,i=(new Date).getTime();this._gameViewShared=e,this._gameContentShared=t,this._element=new l.WebContentElement(t.gameViewElement,this._contentUrl,function(){var t=((new Date).getTime()-i)/1e3;r._dataBus=new a.PostMessageDataBus(r._element.getContentWindow()),r._contentLoadListeners.forEach(function(e){return e.onLoad(t)})}),null==this._contentArea&&this.setContentArea({x:0,y:0,width:t.viewWidth,height:t.viewHeight}),null==this._zIndex&&this.setZIndex(++t.largestZIndex)},d.prototype._update=function(){null!=this._element&&(this._contentAreaNeedsUpdate&&(this._element.setContentArea(this._contentArea),this._contentAreaNeedsUpdate=!1),this._zIndexNeedsUpdate&&(this._element.setZIndex(this._zIndex),this._gameContentShared.largestZIndex=Math.max(this._gameContentShared.largestZIndex,this._zIndex),this._zIndexNeedsUpdate=!1),this._contentLayoutNeedsUpdate&&(this._element.setContentLayout(this._contentLayout),this._contentLayoutNeedsUpdate=!1),this._visibilityNeedsUpdate&&(this._element.setVisibility(this._visibility),this._visibilityNeedsUpdate=!1))},d.prototype.destroy=function(){this._element.destroy(),o.prototype.destroy.call(this)},d);function d(e){var t=o.call(this,e,"web")||this;return t._element=null,t}r.WebContent=u},{"./Content":3,"./DomElement":4,"@cross-border-bridge/post-message-data-bus":39}],17:[function(e,t,r){"use strict";var i;Object.defineProperty(r,"__esModule",{value:!0}),r.AudioMessage=void 0,(i=r.AudioMessage||(r.AudioMessage={})).Load="audio:load",i.Unload="audio:unload",i.CreatePlayer="audio:createPlayer",i.DestroyPlayer="audio:destroyPlayer",i.Play="audio:play",i.Stop="audio:stop",i.ChangeVolume="audio:changeVolume",i.ChangeRate="audio:changeRate"},{}],18:[function(e,t,r){"use strict";var i;Object.defineProperty(r,"__esModule",{value:!0}),r.BridgeAMFlowMessage=r.BridgeMessage=void 0,(r.BridgeMessage||(r.BridgeMessage={})).Init="bridge:init",(i=r.BridgeAMFlowMessage||(r.BridgeAMFlowMessage={})).Open="amf:open",i.Close="amf:close",i.Authenticate="amf:authenticate",i.SendTick="amf:sendTick",i.SubscribeTick="amf:subscribeTick",i.UnsubscribeTick="amf:unsubscribeTick",i.ReceiveTick="amf:[t]",i.SendEvent="amf:sendEvent",i.SubscribeEvent="amf:subscribeEvent",i.UnsubscribeEvent="amf:unsubscribeEvent",i.ReceiveEvent="amf:[e]",i.GetTickList="amf:getTickList",i.PutStartPoint="amf:putStartPoint",i.GetStartPoint="amf:getStartPoint"},{}],19:[function(e,t,r){"use strict";var i;Object.defineProperty(r,"__esModule",{value:!0}),r.LoaderMessage=void 0,(i=r.LoaderMessage||(r.LoaderMessage={})).Start="loader:start",i.PauseGame="loader:pauseGame",i.ResumeGame="loader:resumeGame",i.StopGame="loader:stopGame",i.SendEvents="loader:sendEvents",i.SetExecutionMode="loader:setExecutionMode",i.TargetTime="loader:targetTime",i.SetReplayOriginDate="loader:setReplayOriginDate",i.SetScale="loader:setScale",i.SetMasterVolume="loader:setMasterVolume",i.GetGameVars="loader:getGameVars",i.ChangeDriverState="loader:changeDriverState",i.ResetSurface="loader:resetSurface",i.GameCreated="loader:gameCreated",i.Error="loader:error",i.PlayOriginDate="loader:playOriginDate",i.AcquireAMFlow="loader:acquireAMFlow",i.ReleaseAMFlow="loader:releaseAMFlow",i.ExternalSend="loader:externalSend",i.External="loader:external",i.SkippingChanged="loader:skippingChanged",i.GameLoaded="loader:gameLoaded",i.GameStarted="loader:gameStarted"},{}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PostMessageBridgeBase=void 0;var i=(n.prototype.destroy=function(){this._target=null,this._requestHandlersTable=null,this._handlersTable=null},n.prototype.getTarget=function(){return this._target},n.prototype.request=function(e,t,r){var i="req"+this._requestIndex++,n=this._createRawMessageBase();n.type=e,n.data=t,n.reqId=i,this._target.window.postMessage(n,this._target.targetOrigin),this._requestHandlersTable[i]=r},n.prototype.send=function(e,t){var r=this._createRawMessageBase();r.type=e,r.data=t,this._target.window.postMessage(r,this._target.targetOrigin)},n.prototype.on=function(e,t){var r=this._handlersTable;(r[e]||(r[e]=[])).push({handler:t,isOnce:!1})},n.prototype.once=function(e,t){var r=this._handlersTable;(r[e]||(r[e]=[])).push({handler:t,isOnce:!0})},n.prototype.off=function(e,t){var r=this._handlersTable;r[e]&&0!==r[e].length&&(r[e]=r[e].filter(function(e){return e.handler!==t}))},n.prototype._respond=function(e,t,r){var i=this._createRawMessageBase();i.resId=e,i.data=r,i.errorMessage=t,this._target.window.postMessage(i,this._target.targetOrigin)},n.prototype._handleRawMessageEvent=function(e){var r=this,i=e.data;if(e.source===this._target.window){var t=i.resId;if(null!=t){var n=this._requestHandlersTable[t];return delete this._requestHandlersTable[t],void n(i.errorMessage?new Error(i.errorMessage):null,i.data)}var o=this._handlersTable,a=i.type;if(o&&o.hasOwnProperty(a)&&0<o[a].length){for(var s=o[a].concat(),l=null==i.reqId?null:function(e,t){r._respond(i.reqId,e,t)},u=!1,d=0;d<s.length;++d){var h=s[d];h.handler&&(h.handler(i.data,l),h.isOnce&&(u=!(h.handler=null)))}u&&this.off(a,null)}else null==i.reqId?console.warn("PostMessageBridgeBase: ignored unknown message",i):this._respond(i.reqId,"No corresponding handler",null)}else console.warn("PostMessageBridgeBase: got "+JSON.stringify(i)+" from unknown source")},n.prototype._createRawMessageBase=function(){return{}},n.prototype._setImmediate=function(e){setTimeout(e,0)},n);function n(e){this._requestIndex=0,this._requestHandlersTable={},this._handlersTable={},this._target=e}r.PostMessageBridgeBase=i},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PostMessageBridgeDemux=void 0;var o=e("./BridgeMessage"),s=e("./PostMessageDemuxedBridge");function l(e,t){for(var r=0;r<e.length;++r)if(t(e[r]))return r;return-1}var i=(n.prototype.register=function(t,e,r){if(this._trustedOriginRegExp.test(e)){var i=this.findBridge(t);if(i)this._setImmediate(function(){i.getTarget().targetOrigin!==e?r(new Error("PostMessageBridgeDemux#register(): targetOrigin mismatch: "+e)):r(null,i)});else{var n="PDBT"+this._targetIndex++;i=new s.PostMessageDemuxedBridge(n,{targetOrigin:e,window:t},this._handleDestroyBridge_bound),this._bridgeTable[n]=i;var o=l(this._waitingEvents,function(e){return e.source===t});if(-1!==o){var a=this._waitingEvents.splice(o,1)[0];i.processRawMessageEvent(a)}i.initialize(function(e){return r(e,e?null:i)})}}else this._setImmediate(function(){return r(new Error("PostMessageDemuxedBridge#register(): untrusted origin: "+e))})},n.prototype.destroy=function(){var t=this;Object.keys(this._bridgeTable).forEach(function(e){return t._bridgeTable[e].destroy()}),this._window.removeEventListener("message",this._handleMessage_bound),this._window=null,this._waitingEvents=null,this._bridgeTable=null,this._trustedOriginRegExp=null,this._handleMessage_bound=null,this._handleDestroyBridge_bound=null},n.prototype.findBridge=function(t){return function(t,r){var e=Object.keys(t),i=l(e,function(e){return r(t[e])});return-1!==i?t[e[i]]:null}(this._bridgeTable,function(e){return e.getTarget().window===t})},n.prototype._handleDestroyBridge=function(e){delete this._bridgeTable[e.selfKey]},n.prototype._handleMessage=function(e){if(this._trustedOriginRegExp.test(e.origin)){var t=e.data,r=t.key,i=!r&&t.type===o.BridgeMessage.Init,n=i?this.findBridge(e.source):this._bridgeTable[r];n?n.processRawMessageEvent(e):i&&this._waitingEvents.push(e)}},n.prototype._setImmediate=function(e){setTimeout(e,0)},n);function n(e,t){this._waitingEvents=[],this._targetIndex=0,this._bridgeTable=Object.create(null),this._window=e,this._trustedOriginRegExp=t,this._handleMessage_bound=this._handleMessage.bind(this),this._handleDestroyBridge_bound=this._handleDestroyBridge.bind(this),this._window.addEventListener("message",this._handleMessage_bound)}r.PostMessageBridgeDemux=i},{"./BridgeMessage":18,"./PostMessageDemuxedBridge":22}],22:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.PostMessageDemuxedBridge=void 0;var o,a=e("./BridgeMessage"),s=e("./PostMessageBridgeBase"),l=(o=s.PostMessageBridgeBase,n(u,o),u.prototype.destroy=function(){this._handleBeforeDestroyFunc(this),o.prototype.destroy.call(this),this._isConnected=!1,this._handleBeforeDestroyFunc=null},u.prototype.initialize=function(e){this._isConnected?this._setImmediate(e):this.once(a.BridgeMessage.Init,function(){return e()})},u.prototype.processRawMessageEvent=function(e){this._handleRawMessageEvent(e)},u);function u(e,t,r){var i=o.call(this,t)||this;return i.selfKey=e,i._isConnected=!1,i._handleBeforeDestroyFunc=r,i.once(a.BridgeMessage.Init,function(e,t){t(null,i.selfKey),i._isConnected=!0}),i}r.PostMessageDemuxedBridge=l},{"./BridgeMessage":18,"./PostMessageBridgeBase":20}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setupAMFlowProxy=void 0;var f=e("./BridgeMessage");r.setupAMFlowProxy=function(i,t){function e(e,t){i.open(e,function(e){return t(e?e.message:null)})}function r(e,t){i.close(function(e){return t(e?e.message:null)})}function n(e,r){i.authenticate(e,function(e,t){return e?r(e.message):r(null,t)})}function o(e){return i.sendTick(e)}function a(e){return i.sendEvent(e)}function s(e){return t.send(f.BridgeAMFlowMessage.ReceiveTick,e)}function l(e){return t.send(f.BridgeAMFlowMessage.ReceiveEvent,e)}function u(){return i.onTick(s)}function d(){return i.offTick(s)}function h(){return i.onEvent(l)}function c(){return i.offEvent(l)}function p(e,r){i.getTickList(e.begin,e.end,function(e,t){return e?r(e.message):r(null,t)})}function _(e,t){i.putStartPoint(e,function(e){return t(e?e.message:null)})}function g(e,r){i.getStartPoint(e,function(e,t){return e?r(e.message):r(null,t)})}return t.on(f.BridgeAMFlowMessage.Open,e),t.on(f.BridgeAMFlowMessage.Close,r),t.on(f.BridgeAMFlowMessage.Authenticate,n),t.on(f.BridgeAMFlowMessage.SendTick,o),t.on(f.BridgeAMFlowMessage.SendEvent,a),t.on(f.BridgeAMFlowMessage.SubscribeTick,u),t.on(f.BridgeAMFlowMessage.UnsubscribeTick,d),t.on(f.BridgeAMFlowMessage.SubscribeEvent,h),t.on(f.BridgeAMFlowMessage.UnsubscribeEvent,c),t.on(f.BridgeAMFlowMessage.GetTickList,p),t.on(f.BridgeAMFlowMessage.PutStartPoint,_),t.on(f.BridgeAMFlowMessage.GetStartPoint,g),function(){d(),c(),t.off(f.BridgeAMFlowMessage.Open,e),t.off(f.BridgeAMFlowMessage.Close,r),t.off(f.BridgeAMFlowMessage.Authenticate,n),t.off(f.BridgeAMFlowMessage.SendTick,o),t.off(f.BridgeAMFlowMessage.SendEvent,a),t.off(f.BridgeAMFlowMessage.SubscribeTick,u),t.off(f.BridgeAMFlowMessage.UnsubscribeTick,d),t.off(f.BridgeAMFlowMessage.SubscribeEvent,h),t.off(f.BridgeAMFlowMessage.UnsubscribeEvent,c),t.off(f.BridgeAMFlowMessage.GetTickList,p),t.off(f.BridgeAMFlowMessage.PutStartPoint,_),t.off(f.BridgeAMFlowMessage.GetStartPoint,g)}}},{"./BridgeMessage":18}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setupAudioPdiProxy=void 0;var d=e("./AudioMessage");r.setupAudioPdiProxy=function(r,e){function t(e,t){r.loadAudioAsset(e,function(e){return t(e?e.message:null)})}function i(e){return r.unloadAudioAsset(e)}function n(e){return r.createAudioPlayer(e)}function o(e){return r.destroyAudioPlayer(e)}function a(e){return r.playAudioPlayer(e)}function s(e){return r.stopAudioPlayer(e)}function l(e){r.changeAudioVolume(e.audioPlayerId,e.volume)}function u(e){r.changeAudioPlaybackRate(e.audioPlayerId,e.playbackRate)}return e.on(d.AudioMessage.Load,t),e.on(d.AudioMessage.Unload,i),e.on(d.AudioMessage.CreatePlayer,n),e.on(d.AudioMessage.DestroyPlayer,o),e.on(d.AudioMessage.Play,a),e.on(d.AudioMessage.Stop,s),e.on(d.AudioMessage.ChangeVolume,l),e.on(d.AudioMessage.ChangeRate,u),function(){e.off(d.AudioMessage.Load,t),e.off(d.AudioMessage.Unload,i),e.off(d.AudioMessage.CreatePlayer,n),e.off(d.AudioMessage.DestroyPlayer,o),e.off(d.AudioMessage.Play,a),e.off(d.AudioMessage.Stop,s),e.off(d.AudioMessage.ChangeVolume,l),e.off(d.AudioMessage.ChangeRate,u)}}},{"./AudioMessage":17}],25:[function(e,t,r){"use strict";var i,p=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,r,a):n(t,r))||a);return 3<o&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.createProxyAudioPluginClass=void 0;var g=e("@akashic/pdi-common-impl/lib/AudioAsset"),f=e("@akashic/pdi-common-impl/lib/AudioPlayer");r.createProxyAudioPluginClass=function(e,s){var t,r,u,i=null!==(t=e.AudioAsset)&&void 0!==t?t:g.AudioAsset,l=(p(n,u=i),n.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),u.prototype.destroy.call(this)},n.prototype._load=function(t){var r=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint,offset:this.offset},function(e){e?t._onAssetError(r,e):t._onAssetLoad(r)})},n.prototype._assetPathFilter=function(e){return e},n);function n(e,t,r,i,n,o,a,s){var l=u.call(this,t,r,i,n,o,a,s)||this;return l._handlerSet=e,l}var o,a=null!==(r=e.AudioPlayer)&&void 0!==r?r:f.AudioPlayer,d=(p(h,o=a),h.prototype.changeVolume=function(e){o.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},h.prototype._changeMuted=function(e){o.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},h.prototype.play=function(e){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap"+h._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:e.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),o.prototype.play.call(this,e)},h.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),o.prototype.stop.call(this)},h.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},h.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},h.prototype._calculateVolume=function(){var e=this._manager.getMasterVolume?this._manager.getMasterVolume():1;return this._system._muted?0:this.volume*this._system.volume*e},h._audioPlayerIdCounter=0,h);function h(e,t,r){var i=o.call(this,t)||this;return i._audioPlayerId=null,i._handlerSet=e,i._manager=null!=r?r:null,i}function c(){this.supportedFormats=[]}return c.isSupported=function(){return!0},c.prototype.createAsset=function(e,t,r,i,n,o,a){return void 0===n&&(n="music"===(null==i?void 0:i.id)),void 0===o&&(o={}),void 0===a&&(a=0),new l(s,e,t,r,i,n,o,a)},c.prototype.createPlayer=function(e,t){return new d(s,e,"boolean"!=typeof t?t:void 0)},c=_([function(e){}],c)}},{"@akashic/pdi-common-impl/lib/AudioAsset":30,"@akashic/pdi-common-impl/lib/AudioPlayer":31}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.detectRuntimes=r.detectEngineFilesObject=r.isEngineFilesUrl=r.detectPlaylogClientObject=r.findPlaylogClientUrl=r.isPlaylogClientUrl=void 0;var c=e("./Error");function i(e){return/.*\/playlogClientV.*\.js$/.test(e)}function p(e){for(var t=0;t<e.length;t++){var r=e[t];if(i(r))return r}return null}function _(e){var t=window,r=e.match(/.*\/(playlogClientV.*)\.js$/);return r?t[r[1]]:null}function g(e){return/.*\/engineFilesV.*\.js$/.test(e)}function f(e){var t=e.match(/.*\/(engineFilesV.*)\.js$/);if(t&&window[t[1]]){var r=window[t[1]];return{g:r.akashicEngine,GameDriver:r.gameDriver,PdiBrowser:r.pdiBrowser}}return null}r.isPlaylogClientUrl=i,r.findPlaylogClientUrl=p,r.detectPlaylogClientObject=_,r.isEngineFilesUrl=g,r.detectEngineFilesObject=f,r.detectRuntimes=function(e){for(var t,r=window,i=null,n=null,o=null,a=null,s=0;s<e.length;s++){var l=e[s];if(g(l)){t=l;break}}if(t){var u=f(t);u&&(i=u.g,n=u.GameDriver,o=u.PdiBrowser)}var d=p(e);if(d&&(a=_(d)),i&&n&&o)return[null,{g:i,GameDriver:n,PdiBrowser:o,PlaylogClient:a}];var h=null;try{i=r.require("@akashic/akashic-engine"),n=r.require("@akashic/game-driver"),o=r.require("@akashic/pdi-browser");try{a=r.require("@akashic/playlog-client")}catch(e){}if(i&&n&&o)return[null,{g:i,GameDriver:n,PdiBrowser:o,PlaylogClient:a}]}catch(e){h=e}return[c.ErrorFactory.createLoadMuduleError(h||new Error("unknown failure for require()")),null]}},{"./Error":6}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.assignObject=r.ObjectList=void 0;var i=(n.prototype.addItem=function(e){this._objectList.push(e)},n.prototype.removeItem=function(t){this._objectList=this._objectList.filter(function(e){return e!==t})},n.prototype.removeAllItems=function(){this._objectList=[]},n.prototype.forEach=function(e){this._objectList.forEach(e)},n);function n(){this._objectList=[]}r.ObjectList=i,r.assignObject=function(t,r){return Object.keys(r).forEach(function(e){t[e]=r[e]}),t}},{}],28:[function(e,t,r){"use strict";var i,n,o,a,s,l,u,d;Object.defineProperty(r,"__esModule",{value:!0}),r.ProtocolType=r.ExecutionMode=r.HorizontalAlignment=r.VerticalAlignment=r.ScaleMode=r.DroppedEventType=r.DroppedEventReason=r.EventDropPolicy=void 0,(i=r.EventDropPolicy||(r.EventDropPolicy={}))[i.InReplay=0]="InReplay",i[i.Always=1]="Always",i[i.Never=2]="Never",(n=r.DroppedEventReason||(r.DroppedEventReason={}))[n.Unknown=0]="Unknown",n[n.Replay=1]="Replay",(o=r.DroppedEventType||(r.DroppedEventType={}))[o.Click=0]="Click",o[o.Down=1]="Down",o[o.Move=2]="Move",o[o.Up=3]="Up",(a=r.ScaleMode||(r.ScaleMode={}))[a.None=0]="None",a[a.Fill=1]="Fill",a[a.AspectFit=2]="AspectFit",(s=r.VerticalAlignment||(r.VerticalAlignment={}))[s.Top=0]="Top",s[s.Center=1]="Center",s[s.Bottom=2]="Bottom",(l=r.HorizontalAlignment||(r.HorizontalAlignment={}))[l.Left=0]="Left",l[l.Center=1]="Center",l[l.Right=2]="Right",(u=r.ExecutionMode||(r.ExecutionMode={}))[u.Active=0]="Active",u[u.Passive=1]="Passive",u[u.Replay=2]="Replay",(d=r.ProtocolType||(r.ProtocolType={}))[d.WebSocket=0]="WebSocket"},{}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Asset=void 0;var i=e("@akashic/trigger"),n=(o.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},o.prototype.destroyed=function(){return void 0===this.id},o.prototype.inUse=function(){return!1},o.prototype._assetPathFilter=function(e){return e},o);function o(e,t){this.id=e,this.originalPath=t,this.path=this._assetPathFilter(t),this.onDestroyed=new i.Trigger}r.Asset=n},{"@akashic/trigger":36}],30:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.AudioAsset=void 0;var l,o=e("./Asset"),a=(l=o.Asset,n(s,l),s.prototype.play=function(){var e=this._system.createPlayer();return e.play(this),this._lastPlayedPlayer=e},s.prototype.stop=function(){for(var e=this._system.findPlayers(this),t=0;t<e.length;++t)e[t].stop()},s.prototype.inUse=function(){return 0<this._system.findPlayers(this).length},s.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,l.prototype.destroy.call(this)},s);function s(e,t,r,i,n,o,a){var s=l.call(this,e,t)||this;return s.type="audio",s.duration=r,s.loop=n,s.hint=o,s._system=i,s.data=void 0,s.offset=a,s}r.AudioAsset=a},{"./Asset":29}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioPlayer=void 0;var i=e("@akashic/trigger"),n=(o.prototype.play=function(e){this.currentAudio=e,this.onPlay.fire({player:this,audio:e})},o.prototype.stop=function(){var e=this.currentAudio;e&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:e}))},o.prototype.canHandleStopped=function(){return!0},o.prototype.changeVolume=function(e){this.volume=e},o.prototype._changeMuted=function(e){this._muted=e},o.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},o);function o(e){this.onPlay=new i.Trigger,this.onStop=new i.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._system=e}r.AudioPlayer=n},{"@akashic/trigger":36}],32:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.ChainTrigger=void 0;var o,a=e("./Trigger"),s=(o=a.Trigger,n(l,o),l.prototype.add=function(e,t){o.prototype.add.call(this,e,t),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},l.prototype.addOnce=function(e,t){o.prototype.addOnce.call(this,e,t),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},l.prototype.remove=function(e,t){o.prototype.remove.call(this,e,t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},l.prototype.removeAll=function(e){o.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},l.prototype.destroy=function(){o.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},l.prototype._onChainTriggerFired=function(e){this.filter&&!this.filter.call(this.filterOwner,e)||this.fire(e)},l);function l(e,t,r){var i=o.call(this)||this;return i.chain=e,i.filter=null!=t?t:null,i.filterOwner=r,i._isActivated=!1,i}r.ChainTrigger=s},{"./Trigger":34}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Trigger=void 0;var i=(n.prototype.add=function(e,t){if("function"==typeof e)this._handlers.push({func:e,owner:t,once:!1,name:void 0});else{var r=e;"number"==typeof r.index?this._handlers.splice(r.index,0,{func:r.func,owner:r.owner,once:!1,name:r.name}):this._handlers.push({func:r.func,owner:r.owner,once:!1,name:r.name})}this.length=this._handlers.length},n.prototype.addOnce=function(e,t){if("function"==typeof e)this._handlers.push({func:e,owner:t,once:!0,name:void 0});else{var r=e;"number"==typeof r.index?this._handlers.splice(r.index,0,{func:r.func,owner:r.owner,once:!0,name:r.name}):this._handlers.push({func:r.func,owner:r.owner,once:!0,name:r.name})}this.length=this._handlers.length},n.prototype.handle=function(e,t,r){this.add(t?{owner:e,func:t,name:r}:{func:e})},n.prototype.fire=function(e){if(this._handlers&&this._handlers.length){for(var t=this._handlers.concat(),r=0;r<t.length;r++){var i=t[r];if(i.func.call(i.owner,e)||i.once){if(!this._handlers)continue;var n=this._handlers.indexOf(i);-1!==n&&this._handlers.splice(n,1)}}null!=this._handlers&&(this.length=this._handlers.length)}},n.prototype.contains=function(e,t){for(var r="function"==typeof e?{func:e,owner:t}:e,i=0;i<this._handlers.length;i++)if(this._comparePartial(r,this._handlers[i]))return!0;return!1},n.prototype.remove=function(e,t){for(var r="function"==typeof e?{func:e,owner:t}:e,i=0;i<this._handlers.length;i++){var n=this._handlers[i];if(r.func===n.func&&r.owner===n.owner&&r.name===n.name)return this._handlers.splice(i,1),void--this.length}},n.prototype.removeAll=function(e){var t=[];if(e)for(var r=0;r<this._handlers.length;r++){var i=this._handlers[r];this._comparePartial(e,i)||t.push(i)}this._handlers=t,this.length=this._handlers.length},n.prototype.destroy=function(){this._handlers=null,this.length=null},n.prototype.destroyed=function(){return null===this._handlers},n.prototype._comparePartial=function(e,t){return!(void 0!==e.func&&e.func!==t.func||void 0!==e.owner&&e.owner!==t.owner||void 0!==e.name&&e.name!==t.name)},n);function n(){this._handlers=[],this.length=0}r.Trigger=i},{}],35:[function(e,t,r){arguments[4][33][0].apply(r,arguments)},{dup:33}],36:[function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./TriggerLike"),r),n(e("./ChainTriggerLike"),r),n(e("./Trigger"),r),n(e("./ChainTrigger"),r)},{"./ChainTrigger":32,"./ChainTriggerLike":33,"./Trigger":34,"./TriggerLike":35}],37:[function(e,t,r){var i=(n.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._sender.send.apply(this._sender,e)},n.prototype.addHandler=function(e){this._handlers.push(e)},n.prototype.removeHandler=function(e){var t=this._handlers.indexOf(e);t<0||this._handlers.splice(t,1)},n.prototype.removeAllHandlers=function(){this._handlers=[]},n.prototype.destroy=function(){this.removeAllHandlers(),this._receiver.setHandler(void 0)},n);function n(e,t){this._sender=e,this._receiver=t,this._handlers=[];var r=this;this._receiver.setHandler(function(){for(var e=0,t=r._handlers;e<t.length;e++){t[e].apply(r,arguments)}})}r.MemoryQueueDataBus=i},{}],38:[function(e,t,r){var i=(n.prototype.setHandler=function(e){this._handler=e},n.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._handler&&this._handler.apply(null,e)},n);function n(e){this._handler=e}r.MemoryQueue=i},{}],39:[function(e,t,r){var i=(n.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._target&&this._target.postMessage(JSON.stringify(e),"*")},n.prototype.addHandler=function(e){this._target&&(0===this._handlers.length&&function(e){Object.keys(a).length||window.addEventListener("message",l);var t=o.indexOf(e._target);-1===t&&(t=o.push(e._target)-1),a[t]||(a[t]=[]),a[t].push(e)}(this),this._handlers.push(e))},n.prototype.removeHandler=function(e){if(this._target){var t=this._handlers.indexOf(e);t<0||(this._handlers.splice(t,1),0===this._handlers.length&&s(this))}},n.prototype.removeAllHandlers=function(){this._target&&0!==this._handlers.length&&(this._handlers=[],s(this))},n.prototype._onMessage=function(e){if(this._target&&0!==this._handlers.length){for(var t=[],r=0,i=this._handlers;r<i.length;r++)(o=i[r]).apply(null,e)&&t.push(o);for(var n=0;n<t.length;n++){var o=t[n];this.removeHandler(o)}}},n.prototype.destroy=function(){this._target&&(this.removeAllHandlers(),this._target=void 0)},n);function n(e){this._target=e,this._handlers=[]}r.PostMessageDataBus=i;var o=[],a={};function s(t){var e=o.indexOf(t._target);-1!==e&&(a[e]=a[e].filter(function(e){return e!==t}),a[e].length||(delete a[e],o[e]=null),Object.keys(a).length||window.removeEventListener("message",l))}function l(e){var t=o.indexOf(e.source);if(-1!==t){var r=null;try{r=JSON.parse(e.data)}catch(e){return}a[t].forEach(function(e){e._onMessage(r)})}}},{}],"@akashic/akashic-gameview-web":[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("@akashic/akashic-gameview");Object.defineProperty(r,"ScaleMode",{enumerable:!0,get:function(){return i.ScaleMode}}),Object.defineProperty(r,"VerticalAlignment",{enumerable:!0,get:function(){return i.VerticalAlignment}}),Object.defineProperty(r,"HorizontalAlignment",{enumerable:!0,get:function(){return i.HorizontalAlignment}}),Object.defineProperty(r,"ExecutionMode",{enumerable:!0,get:function(){return i.ExecutionMode}}),Object.defineProperty(r,"ProtocolType",{enumerable:!0,get:function(){return i.ProtocolType}}),Object.defineProperty(r,"EventDropPolicy",{enumerable:!0,get:function(){return i.EventDropPolicy}}),Object.defineProperty(r,"DroppedEventReason",{enumerable:!0,get:function(){return i.DroppedEventReason}}),Object.defineProperty(r,"DroppedEventType",{enumerable:!0,get:function(){return i.DroppedEventType}});var n=e("./AkashicGameViewWeb");Object.defineProperty(r,"AkashicGameView",{enumerable:!0,get:function(){return n.AkashicGameView}});var o=e("./SharedObject");Object.defineProperty(r,"GameViewSharedObject",{enumerable:!0,get:function(){return o.GameViewSharedObject}}),Object.defineProperty(r,"GameContentSharedObject",{enumerable:!0,get:function(){return o.GameContentSharedObject}});var a=e("./Content");Object.defineProperty(r,"Content",{enumerable:!0,get:function(){return a.Content}});var s=e("./Downloader");Object.defineProperty(r,"XhrDownloader",{enumerable:!0,get:function(){return s.XhrDownloader}}),Object.defineProperty(r,"RetryDownloader",{enumerable:!0,get:function(){return s.RetryDownloader}});var l=e("./WebContent");Object.defineProperty(r,"WebContent",{enumerable:!0,get:function(){return l.WebContent}});var u=e("./GameContent");Object.defineProperty(r,"GameContent",{enumerable:!0,get:function(){return u.GameContent}});var d=e("./utils");Object.defineProperty(r,"ObjectList",{enumerable:!0,get:function(){return d.ObjectList}});var h=e("./ExternalPluginSignatureCaller");Object.defineProperty(r,"ExternalPluginSignatureCaller",{enumerable:!0,get:function(){return h.ExternalPluginSignatureCaller}})},{"./AkashicGameViewWeb":1,"./Content":3,"./Downloader":5,"./ExternalPluginSignatureCaller":8,"./GameContent":9,"./SharedObject":12,"./WebContent":16,"./utils":27,"@akashic/akashic-gameview":28}]},{},[]);